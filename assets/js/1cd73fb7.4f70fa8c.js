"use strict";(self.webpackChunkcloudshell_help=self.webpackChunkcloudshell_help||[]).push([[84236],{17756:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>a});var s=n(17624),l=n(4552);const r={sidebar_position:10},i="App Deployment",o={id:"devguide/develop-custom-cloud-provider-shells/app-deployment",title:"App Deployment",description:"In this article, we\u2019ll learn how to implement the App\u2019s deployment.",source:"@site/docs/devguide/develop-custom-cloud-provider-shells/app-deployment.md",sourceDirName:"devguide/develop-custom-cloud-provider-shells",slug:"/devguide/develop-custom-cloud-provider-shells/app-deployment",permalink:"/cloudshell-help/next/devguide/develop-custom-cloud-provider-shells/app-deployment",draft:!1,unlisted:!1,editUrl:"https://github.com/QualiSystems/cloudshell-help/tree/main/docs/devguide/develop-custom-cloud-provider-shells/app-deployment.md",tags:[],version:"current",lastUpdatedAt:1715709427e3,sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"Resource Discovery",permalink:"/cloudshell-help/next/devguide/develop-custom-cloud-provider-shells/resource-discovery"},next:{title:"Power off and Delete VM",permalink:"/cloudshell-help/next/devguide/develop-custom-cloud-provider-shells/power-off-and-delete-vm"}},d={},a=[{value:"Deploy method",id:"deploy-method",level:2},{value:"Signature",id:"signature",level:3},{value:"Inputs",id:"inputs",level:3},{value:"context",id:"context",level:4},{value:"Request",id:"request",level:4},{value:"cancellation_context",id:"cancellation_context",level:4},{value:"Output",id:"output",level:3},{value:"Error handling",id:"error-handling",level:3},{value:"Deploy method implementation",id:"deploy-method-implementation",level:3},{value:"DeployAppResult JSON example",id:"deployappresult-json-example",level:3},{value:"DeployAppResult properties",id:"deployappresult-properties",level:3},{value:"PowerOn method",id:"poweron-method",level:2},{value:"Signature",id:"signature-1",level:3},{value:"Inputs",id:"inputs-1",level:3},{value:"context",id:"context-1",level:4},{value:"Ports",id:"ports",level:4},{value:"PowerOn method implementation",id:"poweron-method-implementation",level:3},{value:"PowerOn implementation example",id:"poweron-implementation-example",level:3},{value:"Return value",id:"return-value",level:3},{value:"Error handling",id:"error-handling-1",level:3},{value:"remote_refresh_ip",id:"remote_refresh_ip",level:2},{value:"Signature",id:"signature-2",level:3},{value:"Inputs",id:"inputs-2",level:3},{value:"context",id:"context-2",level:4},{value:"Ports",id:"ports-1",level:4},{value:"Cancellation context",id:"cancellation-context",level:4},{value:"Return value",id:"return-value-1",level:3},{value:"Error handling",id:"error-handling-2",level:3},{value:"remote_refresh_ip method implementation",id:"remote_refresh_ip-method-implementation",level:3},{value:"GetVmDetails method",id:"getvmdetails-method",level:2},{value:"Signature",id:"signature-3",level:3},{value:"Inputs",id:"inputs-3",level:3},{value:"context",id:"context-3",level:4},{value:"Requests",id:"requests",level:4},{value:"Cancellation request",id:"cancellation-request",level:4},{value:"Return value",id:"return-value-2",level:3},{value:"vmDetailsData properties",id:"vmdetailsdata-properties",level:3},{value:"VmDetailsNetworkInterface",id:"vmdetailsnetworkinterface",level:3},{value:"VmDetailsProperty",id:"vmdetailsproperty",level:3},{value:"GetVmDetails method implementation",id:"getvmdetails-method-implementation",level:3}];function c(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.M)(),...e.components},{Details:r}=t;return r||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"app-deployment",children:"App Deployment"}),"\n",(0,s.jsx)(t.p,{children:"In this article, we\u2019ll learn how to implement the App\u2019s deployment."}),"\n",(0,s.jsx)(t.p,{children:"To deploy an App successfully, you need to implement the following 4 methods:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#deploy-method",children:"Deploy method"})," creates the App\u2019s VM instance."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#poweron-method",children:"PowerOn method"}),"\xa0spins up the VM."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#remote_refresh_ip",children:"remote_refresh_ip"}),"\xa0updates the deployed App\u2019s IP address."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#getvmdetails-method",children:"GetVmDetails method"}),"\xa0gets information about the VM itself, its operating system, specifications and networking information."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["These methods are executed in the above order during the deployment of an App in the sandbox (either automatically as part of the default sandbox setup script that runs when reserving a sandbox or manually by the user after adding an App to an active sandbox). Once the App is deployed, these methods can be run as individual commands from the deployed App\u2019s commands pane, with the exception of the\xa0",(0,s.jsx)(t.em,{children:"Deploy"}),"\xa0command which is no longer needed once the App is deployed."]}),"\n",(0,s.jsx)(t.h2,{id:"deploy-method",children:"Deploy method"}),"\n",(0,s.jsx)(t.p,{children:"Creates the App\u2019s VM instance."}),"\n",(0,s.jsx)(t.h3,{id:"signature",children:"Signature"}),"\n",(0,s.jsxs)(t.p,{children:["The\xa0",(0,s.jsx)(t.em,{children:"deploy"}),"\xa0method accepts three inputs:\xa0",(0,s.jsx)(t.em,{children:"context"}),",\xa0",(0,s.jsx)(t.em,{children:"request"}),", and\xa0",(0,s.jsx)(t.em,{children:"cancellation_context"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/865f356f4aec14e170cd9e5f30b575c48f2dc865/src/driver.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,s.jsxs)(t.p,{children:["src/driver.py ",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/865f356f4aec14e170cd9e5f30b575c48f2dc865/src/driver.py",children:"view"})," ",(0,s.jsx)(t.a,{href:"https://raw.githubusercontent.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/865f356f4aec14e170cd9e5f30b575c48f2dc865/src/driver.py",children:"raw"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"def Deploy(self, context, request, cancellation_context=None):\n"})}),"\n",(0,s.jsx)(t.h3,{id:"inputs",children:"Inputs"}),"\n",(0,s.jsx)(t.h4,{id:"context",children:"context"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"context:"}),"\xa0",(0,s.jsx)(t.em,{children:"context"}),"\xa0is a\xa0",(0,s.jsx)(t.em,{children:"ResourceCommandContext"}),"\xa0object that contains:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"reservation - current reservation details"}),"\n",(0,s.jsx)(t.li,{children:"connectors \u2013 details of any visual connectors between the Cloud Provider App and other endpoints in the sandbox"}),"\n",(0,s.jsx)(t.li,{children:"connectivity - CloudShell server connectivity data for authentication with CloudShell Automation API"}),"\n",(0,s.jsxs)(t.li,{children:["resource - resource configuration settings entered when creating the Cloud Provider resource in the\xa0",(0,s.jsx)(t.strong,{children:"Inventory"}),"\xa0dashboard"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,s.jsxs)(t.p,{children:["cloudshell/shell/core/driver_context.py ",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"view"})," ",(0,s.jsx)(t.a,{href:"https://raw.githubusercontent.com/QualiSystems/cloudshell-shell-core/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"raw"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'class ResourceCommandContext:\n    def __init__(self, connectivity, resource, reservation, connectors):\n        self.connectivity = connectivity  # Connectivity details that can help connect to the APIs\n        """:type : ConnectivityContext"""\n        self.resource = resource  # The details of the resource using the driver\n        """:type : ResourceContextDetails"""\n        self.reservation = reservation  # The details of the reservation\n        """:type : ReservationContextDetails"""\n        self.connectors = connectors  # The list of visual connectors and routes that are connected to the resource (the resource will be considered as the source end point)\n        """:type : list[Connector]"""\n'})}),"\n",(0,s.jsx)(t.h4,{id:"request",children:"Request"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"request:"}),"\xa0",(0,s.jsx)(t.em,{children:"request"})," is an ",(0,s.jsx)(t.em,{children:"AppContext"})," object that contains:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Resource deployment path (in the App template\u2019s\xa0",(0,s.jsx)(t.strong,{children:"Deployment Paths"}),"\xa0page)"]}),"\n",(0,s.jsxs)(t.li,{children:["Deployed App configuration (in the App template\u2019s\xa0",(0,s.jsx)(t.strong,{children:"App Resource"}),"\xa0page)"]}),"\n"]}),"\n",(0,s.jsxs)(r,{children:[(0,s.jsx)("summary",{children:'Example: app_request_json for App "Ubuntu\xa0OCI\xa018.04" that is connected to a single subnet service...'}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:'{\n   "  ""driverRequest":" "{\n      "    ""actions":" "[\n         "      "{\n            "        ""actionParams":" "{\n               "          ""cidr":" ""10.0.1.32/28",\n               "          ""subnetId":" ""ocid1.subnet.oc1.uk-london-1.aa...ovena",\n               "          ""isPublic":" true",\n               "          ""vnicName":" null",\n               "          ""subnetServiceAttributes":" "[\n                  "          "\n               ],\n               "          ""type":" ""connectToSubnetParams""        "\n            },\n            "        ""actionId":" ""bw23c565-5aba-40wa-9fba-69287rf542cf",\n            "        ""type":" ""connectSubnet""      "\n         },\n         "      "{\n            "        ""actionParams":" "{\n               "          ""appName":" ""Ubuntu OCI 18.04",\n               "          ""deployment":" "{\n                  "        \n            ""deploymentPath":" ""OCI Shell.OCI VM from Image",\n                  "            ""attributes":" "[\n                     "              "{\n                        "                ""attributeName":" ""OCI Shell.OCI VM from Image.Inbound Ports",\n                        "                ""attributeValue":" ""22",\n                        "                ""type":" ""attribute""              "\n                     },\n                     "              "{\n                        "                ""attributeName":" ""OCI Shell.OCI VM from Image.Skip VNIC src or dst check",\n                        "                ""attributeValue":" ""False",\n                        "                ""type":" ""attribute""              "\n                     },\n                     "              "{\n                        "                ""attributeName":" ""OCI Shell.OCI VM from Image.Autoload",\n                        "                ""attributeValue":" ""True",\n                        "                ""type":" ""attribute""              "\n                     },\n                     "              "{\n                        "                ""attributeName":" ""OCI Shell.OCI VM from Image.Wait for IP",\n                        "                ""attributeValue":" ""True",\n                        "                ""type":" ""attribute""              "\n                     },\n                     "              "{\n                        "                ""attributeName":" ""OCI Shell.OCI VM from Image.Image ID",\n                        "                ""attributeValue":" ""ocid1.image.oc1.uk-london-1.aausaaaagcmjzblg9wliwb2fxpr7t4nv7j4ertujgosyoctlkismlwi3cbq",\n                        "                ""type":" ""attribute""              "\n                     },\n                     "              "{\n                        "                ""attributeName":" ""OCI Shell.OCI VM from Image.VM Shape",\n                        "                ""attributeValue":" ""VM.Standard2.4",\n                        "                ""type":" ""attribute""              "\n                     },\n                     "              "{\n                        "                ""attributeName":" ""OCI Shell.OCI VM from Image.Add Public IP",\n                        "                ""attributeValue":" ""True",\n                        "                ""type":" ""attribute""              "\n                     },\n                     "              "{\n                        "                ""attributeName":" ""OCI Shell.OCI VM from Image.Requested Private IP",\n                        "                ""attributeValue":" ""32.2.2.4;11.0.0.4;35.0.0.20",\n                        "                ""type":" ""attribute""              "\n                     }"            "\n                  ],\n                  "            ""type":" ""deployAppDeploymentInfo""          "\n               },\n               "          ""appResource":" "{\n                  "            ""attributes":" "[\n                     "              "{\n                        "                ""attributeName":" ""Password",\n                        "                ""attributeValue":" ""encrypted password here",\n                        "                ""type":" ""attribute""              "\n                     },\n                     "              "{\n                        "                ""attributeName":" ""Public IP",\n                        "                ""attributeValue":" """,\n                        "                ""type":" ""attribute""              "\n                     },\n                     "              "{\n                        "                ""attributeName":" ""User",\n                        "                ""attributeValue":" ""ubuntu",\n                        "                ""type":" ""attribute""              "\n                     }"            "\n                  ],\n                  "            ""type":" ""appResourceInfo""          "\n               },\n               "          ""type":" ""deployAppParams""        "\n            },\n            "        ""actionId":" ""c1256ebf-01d9-4804-4oi9-63ad31s4s281",\n            "        ""type":" ""deployApp""      "\n         }"    "\n      ]"  "\n   }\n}\n'})})]}),"\n",(0,s.jsx)(t.h4,{id:"cancellation_context",children:"cancellation_context"}),"\n",(0,s.jsx)(t.p,{children:"CloudShell supports the canceling of App command executions."}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,s.jsxs)(t.p,{children:["cloudshell/shell/core/driver_context.py ",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"view"})," ",(0,s.jsx)(t.a,{href:"https://raw.githubusercontent.com/QualiSystems/cloudshell-shell-core/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"raw"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'def __init__(self):\n    self.is_cancelled = False\n    """:type : bool"""\n'})}),"\n",(0,s.jsx)(t.p,{children:"To allow the cancellation of a command on the Cloud Provider\u2019s Apps, we need to:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Check for cancellation before each operation. If cancelled, delete cloud objects created by operation."}),"\n",(0,s.jsx)(t.li,{children:"Return the appropriate result."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Usage example:"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/865f356f4aec14e170cd9e5f30b575c48f2dc865/src/heavenly_cloud_service_wrapper.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,s.jsxs)(t.p,{children:["src/heavenly_cloud_service_wrapper.py ",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/865f356f4aec14e170cd9e5f30b575c48f2dc865/src/heavenly_cloud_service_wrapper.py",children:"view"})," ",(0,s.jsx)(t.a,{href:"https://raw.githubusercontent.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/865f356f4aec14e170cd9e5f30b575c48f2dc865/src/heavenly_cloud_service_wrapper.py",children:"raw"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"if cancellation_context.is_cancelled:\n      # rollback what we created for current executing command then raise exception\n      # HeavenlyCloudService.rollback()\n      raise Exception('Operation cancelled')\n"})}),"\n",(0,s.jsx)(t.h3,{id:"output",children:"Output"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.em,{children:"DriverResponse"}),"\xa0object that contains a list of action results."]}),"\n",(0,s.jsx)(t.h3,{id:"error-handling",children:"Error handling"}),"\n",(0,s.jsx)(t.p,{children:"If App deployment fails, return a \u201csuccess false\u201d action result."}),"\n",(0,s.jsx)(t.h3,{id:"deploy-method-implementation",children:"Deploy method implementation"}),"\n",(0,s.jsx)(t.p,{children:"The deploy method should perform the following steps:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/driver.py#L91",children:"Retrieve the cloud provider resource\u2019s connection credentials"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/driver.py#L92-L95",children:"Retrieve the\xa0Deploy\xa0action"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/driver.py#L99-L106",children:"Call the\xa0Deploy\xa0logic of the selected deployment type"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.em,{children:"(Steps 4 - 8 are performed within the deploy logic)"}),"\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L3-Cloud-Provider-Shell-Example/blob/4aa0c863da205686952e414e16a0baea954b2bfa/src/heavenly_cloud_service_wrapper.py#L22",children:"Generate a unique name for the App. For example, \u201cMy-App_968e-a950\u201d"}),". Deployed Apps are classified as resources in CloudShell and therefore must have a unique name."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/heavenly_cloud_service_wrapper.py#L47-L48",children:"Create a VM instance using the deployment path attributes"}),"\xa0(the HeavenlyCloud service represents your custom cloud SDK)."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"If VM deployment is successful:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/heavenly_cloud_service_wrapper.py#L78-L79",children:"Collect VM details"}),"\xa0(operating system, specifications, networking information)."]}),"\n",(0,s.jsxs)(t.li,{children:["Optionally,\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/heavenly_cloud_service_wrapper.py#L59-L62",children:"override App resource attribute values"}),". For\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/heavenly_cloud_service_wrapper.py#L51-L58",children:"example"}),", if we generate a unique password for each VM instance, we will also want to update this password in the Password attribute on the Deployed App Resource for future use (to allow the sandbox end-user to connect to the VM)."]}),"\n",(0,s.jsxs)(t.li,{children:["If needed,\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/heavenly_cloud_service_wrapper.py#L84-L88",children:"add additional data to the action result"}),". This key-value data will be available from all API resource queries. It can be useful for implementing custom logic during the lifecycle of the sandbox.\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/heavenly_cloud_service_wrapper.py#L245-L249",children:"Example"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["If VM deployment fails,\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/heavenly_cloud_service_wrapper.py#L74-L76",children:"return a \u201cfail\u201d result"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/heavenly_cloud_service_wrapper.py#L92-L99",children:(0,s.jsx)(t.em,{children:"Return\xa0DeployAppResult"})}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/a9a14e87570fdc52d9994950e161b104c62401fb/src/driver.py#L112",children:(0,s.jsx)(t.em,{children:"Return\xa0DriverResponse"})}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Note that the links in the above workflow pertain to a driver of an L2 implementation. However, the only difference between L2 and L3 driver implementations is that L2 implements\xa0",(0,s.jsx)(t.em,{children:"ApplyConnectivityChanges"}),"\xa0while L3 uses the\xa0",(0,s.jsx)(t.em,{children:"PrepareSandboxInfra"}),"\xa0and\xa0",(0,s.jsx)(t.em,{children:"CleanSandboxInfra"}),"\xa0methods."]}),"\n",(0,s.jsx)(t.h3,{id:"deployappresult-json-example",children:"DeployAppResult JSON example"}),"\n",(0,s.jsxs)(r,{children:[(0,s.jsx)("summary",{children:"Example..."}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:'{\n   " ""actionId":"aac7cc0c-a215-4aee-8fc1-f72020.1.034423",\n   " ""deployedAppAdditionalData":{\n      \n   },\n   " ""deployedAppAddress":"192.168.0.5",\n   " ""deployedAppAttributes":[\n      "   "{\n         "     ""attributeName":"Password",\n         "     ""attributeValue":"123456""   "\n      },\n      "   "{\n         "     ""attributeName":"User",\n         "     ""attributeValue":"super user""   "\n      }" "\n   ],\n   " ""errorMessage":"",\n   " ""infoMessage":"",\n   " ""success":true,\n   " ""type":"DeployApp",\n   " ""vmDetailsData":{\n      "   ""appName":"",\n      "   ""errorMessage":"",\n      "   ""vmInstanceData":[\n         "     "{\n            "       ""hidden":false,\n            "       ""key":"Cloud Name",\n            "       ""value":"white""     "\n         },\n         "     "{\n            "       ""hidden":false,\n            "       ""key":"Cloud Index",\n            "       ""value":"0""     "\n         },\n         "     "{\n            "       ""hidden":false,\n            "       ""key":"Cloud Size",\n            "       ""value":"not so big""     "\n         },\n         "     "{\n            "       ""hidden":false,\n            "       ""key":"Instance Name",\n            "       ""value":"angel vm__ca11f5""     "\n         },\n         "     "{\n            "       ""hidden":true,\n            "       ""key":"Hidden stuff",\n            "       ""value":"something not for UI""     "\n         }"   "\n      ],\n      "   ""vmNetworkData":[\n         "     "{\n            "       ""interfaceId":0,\n            "       ""isPredefined":false,\n            "       ""isPrimary":true,\n            "       ""networkData":[\n               "         "{\n                  "           ""hidden":false,\n                  "           ""key":"MaxSpeed",\n                  "           ""value":"1KB""         "\n               },\n               "         "{\n                  "           ""hidden":false,\n                  "           ""key":"Network Type",\n                  "           ""value":"Ethernet""         "\n               }"       "\n            ],\n            "       ""networkId":0,\n            "       ""privateIpAddress":"10.0.0.0",\n            "       ""publicIpAddress":"8.8.8.0""     "\n         },\n         "     "{\n            "       ""interfaceId":1,\n            "       ""isPredefined":false,\n            "       ""isPrimary":false,\n            "       ""networkData":[\n               "         "{\n                  "           ""hidden":false,\n                  "           ""key":"MaxSpeed",\n                  "           ""value":"1KB""         "\n               },\n               "         "{\n                  "           ""hidden":false,\n                  "           ""key":"Network Type",\n                  "           ""value":"Ethernet""         "\n               }"       "\n            ],\n            "       ""networkId":1,\n            "       ""privateIpAddress":"10.0.0.1",\n            "       ""publicIpAddress":"8.8.8.1""     "\n         }"   "\n      ]" "\n   },\n   " ""vmName":"angel vm__ca11f5",\n   " ""vmUuid":"027ad770-9ecb-4936-a7df-aeaf526dfc34"\n}\n'})})]}),"\n",(0,s.jsx)(t.h3,{id:"deployappresult-properties",children:"DeployAppResult properties"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"actionId"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{children:"(Mandatory) The action GUID as received (deploy_app_action.actionId) result must include the action id it results for, so server can match result to action."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"deployedAppAddress"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{children:"(Mandatory) The primary ip address of the VM instance. This value will be set as the deployed App\u2019s resource address in CloudShell."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"errorMessage"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{children:"(Optional) Error message to be displayed to the sandbox end-user if VM deployment fails."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"infoMessage"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{children:"(Optional) Info message to be displayed to the sandbox end-user if VM deployment succeeds."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"success"}),(0,s.jsx)(t.td,{children:"bool"}),(0,s.jsx)(t.td,{children:"(Mandatory)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"type"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsxs)(t.td,{children:["(Read only)\xa0",(0,s.jsx)(t.em,{children:"DeployApp"}),"\xa0object type. It is automatically set in\xa0",(0,s.jsx)(t.em,{children:"DeployAppResult"}),"\xa0object type (in cloudshell-cp-core)."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"vmName"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{children:"Unique name of the resource in CloudShell."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"vmUuid"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsxs)(t.td,{children:["Unique resource id. Populate\xa0",(0,s.jsx)(t.em,{children:"vmUuid"}),"\xa0with the unique id of the resource in your custom cloud provider. Cloudshell does not use this id, but will keep it for other method calls."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"deployedAppAdditionalData"}),(0,s.jsx)(t.td,{children:"dictionary"}),(0,s.jsxs)(t.td,{children:["Container used to persist custom data in resource, similar to AWS Tags. Included in all resource API query results. For\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ac94224fd2368aaa9b589bcdfd30e449a53c90ce/src/heavenly_cloud_service_wrapper.py#L209-L213",children:"example"}),", reading the custom data and returning it in the VM Details."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"deployedAppAttributes"}),(0,s.jsx)(t.td,{children:"array"}),(0,s.jsxs)(t.td,{children:["Contains data describing the deployed app attributes, and are displayed in the App\u2019s\xa0Attributes\xa0pane in the sandbox. It should be used to change default attribute values on the deployed App resource. For example User & Password attributes exist as part of the default deployed App model. If your custom cloud provider generates a password in runtime for the VM, you should update the\xa0",(0,s.jsx)(t.em,{children:"deployedAppAttributes"}),"\xa0property accordingly."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"vmDetailsData"}),(0,s.jsx)(t.td,{children:"object"}),(0,s.jsxs)(t.td,{children:["Contains vmNetworkData and vmInstanceData. Displayed in the App\u2019s VM Details pane. For details about the return data, see the ",(0,s.jsx)(t.a,{href:"#getvmdetails-method",children:"GetVmDetails method"}),"\u2019s\xa0Return value\xa0section below."]})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"poweron-method",children:"PowerOn method"}),"\n",(0,s.jsxs)(t.p,{children:["The\xa0",(0,s.jsx)(t.em,{children:"PowerOn"}),"\xa0method spins up the VM. It is run automatically when reserving the sandbox, as part of CloudShell\u2019s default sandbox setup script, and can also be run manually by the sandbox end-user from the deployed App\u2019s commands pane. During\xa0",(0,s.jsx)(t.em,{children:"PowerOn"}),", the VM\u2019s IP address and a green live status icon are displayed on the App in sandbox."]}),"\n",(0,s.jsxs)(t.p,{children:["You don\u2019t have to implement this method if the ",(0,s.jsx)(t.em,{children:"deploy"})," method has been configured to spin up the VM. If ",(0,s.jsx)(t.em,{children:"PowerOn"})," does not fail, CloudShell will set resource state to \u201conline\u201d once the VM is up."]}),"\n",(0,s.jsx)(t.h3,{id:"signature-1",children:"Signature"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"def PowerOn(self, context, ports)\n"})}),"\n",(0,s.jsx)(t.h3,{id:"inputs-1",children:"Inputs"}),"\n",(0,s.jsx)(t.h4,{id:"context-1",children:"context"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"context:"}),"\xa0",(0,s.jsx)(t.em,{children:"context"}),"\xa0is a\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py#L171-L180",children:"ResourceRemoteCommandContext"}),"\xa0object that contains:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"connectivity - CloudShell server connectivity data for authentication with CloudShell Automation API"}),"\n",(0,s.jsxs)(t.li,{children:["resource - resource configuration settings entered by the user when creating the Cloud Provider resource in the\xa0",(0,s.jsx)(t.strong,{children:"Inventory"}),"\xa0dashboard"]}),"\n",(0,s.jsx)(t.li,{children:"remote_reservation \u2013 reservation details"}),"\n",(0,s.jsxs)(t.li,{children:["remote_endpoints- will contain a single\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py#L38-L64",children:"ResourceContextDetails"}),"\xa0object which provides data for the operation."]}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"ports",children:"Ports"}),"\n",(0,s.jsx)(t.p,{children:"Legacy argument. Obsolete for custom cloud providers."}),"\n",(0,s.jsx)(t.h3,{id:"poweron-method-implementation",children:"PowerOn method implementation"}),"\n",(0,s.jsxs)(t.p,{children:["The\xa0",(0,s.jsx)(t.em,{children:"PowerOn"}),"\xa0method should perform the following steps:"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Retrieve the cloud provider resource\u2019s connection credentials."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Convert the\xa0",(0,s.jsx)(t.em,{children:"deployed_app_json"}),"\xa0context from string to object."]}),"\n",(0,s.jsx)(t.p,{children:"The json contains information about the CloudShell server, the deployed App and reservation."}),"\n",(0,s.jsx)(t.p,{children:"For details, copy the json contents into your preferred JSON editor. For example:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"PowerOn JSON",src:n(36248).c+"",width:"1451",height:"772"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Power on the deployed App resource."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"poweron-implementation-example",children:"PowerOn implementation example"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ea88bab874c42d69508ba5b2542e867c5b375d5f/src/driver.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,s.jsxs)(t.p,{children:["src/driver.py ",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ea88bab874c42d69508ba5b2542e867c5b375d5f/src/driver.py",children:"view"})," ",(0,s.jsx)(t.a,{href:"https://raw.githubusercontent.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/ea88bab874c42d69508ba5b2542e867c5b375d5f/src/driver.py",children:"raw"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"def PowerOn(self, context, ports):\n      \"\"\"\n      Will power on the compute resource\n      :param ResourceRemoteCommandContext context:\n      :param ports:\n      \"\"\"\n      with LoggingSessionContext(context) as logger, ErrorHandlingContext(logger):\n          self._log(logger, 'power_on_context', context)\n          self._log(logger, 'power_on_ports', ports)\n          cloud_provider_resource = L2HeavenlyCloudShell.create_from_context(context)\n          resource_ep =  context.remote_endpoints[0]\n          deployed_app_dict = json.loads(resource_ep.app_context.deployed_app_json)\n          vm_uid = deployed_app_dict['vmdetails']['uid']\n          HeavenlyCloudServiceWrapper.power_on(cloud_provider_resource,vm_uid)\n"})}),"\n",(0,s.jsx)(t.h3,{id:"return-value",children:"Return value"}),"\n",(0,s.jsx)(t.p,{children:"None"}),"\n",(0,s.jsx)(t.h3,{id:"error-handling-1",children:"Error handling"}),"\n",(0,s.jsx)(t.p,{children:"In case of an error, the command should raise an exception."}),"\n",(0,s.jsx)(t.h2,{id:"remote_refresh_ip",children:"remote_refresh_ip"}),"\n",(0,s.jsxs)(t.p,{children:["The\xa0",(0,s.jsx)(t.em,{children:"remote_refresh_ip"}),"\xa0method retrieves the VM\u2019s updated IP address from the cloud provider and sets it on the deployed App resource. The IP of the main network interface also needs to be retrieved from the cloud provider. Both private and public IPs are retrieved, as appropriate."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.em,{children:"remote_refresh_ip"}),"\xa0is run automatically during the sandbox\u2019s setup, after the VM is created and connected to networks, and can also be run manually by the sandbox end-user by running the\xa0",(0,s.jsx)(t.strong,{children:"Refresh IP"}),"\xa0command in the sandbox."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Note:"}),"\xa0This method is mandatory. However, you can choose to disable the call to this method during setup using the\xa0",(0,s.jsx)(t.strong,{children:"Wait for IP"}),"\xa0attribute. For details, see\xa0",(0,s.jsx)(t.a,{href:"/cloudshell-help/next/devguide/develop-custom-cloud-provider-shells/controlling-app-deployment-orch",children:"Controlling App Deployment Orchestration"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"signature-2",children:"Signature"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"def remote_refresh_ip(self, context, ports, cancellation_context):\n"})}),"\n",(0,s.jsx)(t.h3,{id:"inputs-2",children:"Inputs"}),"\n",(0,s.jsx)(t.h4,{id:"context-2",children:"context"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"context:"}),"\xa0",(0,s.jsx)(t.em,{children:"context"}),"\xa0is a\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py#L171-L180",children:"ResourceRemoteCommandContext"}),"\xa0object that contains:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"connectivity - CloudShell server connectivity data for authentication with CloudShell Automation API"}),"\n",(0,s.jsxs)(t.li,{children:["resource - resource configuration settings entered when creating the Cloud Provider resource in the\xa0",(0,s.jsx)(t.em,{children:"Inventory"}),"\xa0dashboard"]}),"\n",(0,s.jsx)(t.li,{children:"remote_reservation \u2013 reservation details"}),"\n",(0,s.jsxs)(t.li,{children:["remote_endpoints - will contain a single\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py#L38-L64",children:"ResourceContextDetails"}),"\xa0object which provides data for the operation."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,s.jsxs)(t.p,{children:["cloudshell/shell/core/driver_context.py ",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"view"})," ",(0,s.jsx)(t.a,{href:"https://raw.githubusercontent.com/QualiSystems/cloudshell-shell-core/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"raw"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'def __init__(self, connectivity, resource, remote_reservation, remote_endpoints):\n    self.connectivity = connectivity  # Connectivity details that can help connect to the APIs\n    """:type : ConnectivityContext"""\n    self.resource = resource  # The details of the resource using the driver\n    """:type : ResourceContextDetails"""\n    self.remote_reservation = remote_reservation  # The details of the remote reservation\n    """:type : ReservationContextDetails"""\n    self.remote_endpoints = remote_endpoints\n    """:type : list[ResourceContextDetails]"""\n'})}),"\n",(0,s.jsx)(t.h4,{id:"ports-1",children:"Ports"}),"\n",(0,s.jsx)(t.p,{children:"Legacy argument. Obsolete for custom cloud providers."}),"\n",(0,s.jsx)(t.h4,{id:"cancellation-context",children:"Cancellation context"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,s.jsxs)(t.p,{children:["cloudshell/shell/core/driver_context.py ",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"view"})," ",(0,s.jsx)(t.a,{href:"https://raw.githubusercontent.com/QualiSystems/cloudshell-shell-core/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"raw"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'def __init__(self):\n    self.is_cancelled = False\n    """:type : bool"""\n'})}),"\n",(0,s.jsx)(t.h3,{id:"return-value-1",children:"Return value"}),"\n",(0,s.jsx)(t.p,{children:"None."}),"\n",(0,s.jsxs)(t.p,{children:["Unlike other methods that update data using the result,\xa0",(0,s.jsx)(t.em,{children:"remote_refresh_ip"}),"\xa0updates the deployed App resource with the IP by calling\xa0",(0,s.jsx)(t.em,{children:"cloudshell-automation-api"}),". However, if you implemented a return output, make sure to convert the\xa0",(0,s.jsx)(t.em,{children:"remote_refresh_ip"}),"\xa0object to a string and pass the value to the \u201cIP\u201d attribute on the deployed App."]}),"\n",(0,s.jsx)(t.h3,{id:"error-handling-2",children:"Error handling"}),"\n",(0,s.jsx)(t.p,{children:"If the operation fails, the command should raise an exception."}),"\n",(0,s.jsx)(t.h3,{id:"remote_refresh_ip-method-implementation",children:"remote_refresh_ip method implementation"}),"\n",(0,s.jsx)(t.p,{children:"This method should perform the following steps:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ede6f78b4d4a78ae61b628696f6903d684e2224b/src/driver.py#L200",children:"Retrieve the Cloud Provider resource\u2019s connection credentials"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ede6f78b4d4a78ae61b628696f6903d684e2224b/src/driver.py#L201",children:"Convert the\xa0deployed_app_json\xa0context from string to object"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ede6f78b4d4a78ae61b628696f6903d684e2224b/src/driver.py#L202-L212",children:"Retrieve previously known private/public IPs (if there are any), VM instance id"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ede6f78b4d4a78ae61b628696f6903d684e2224b/src/heavenly_cloud_service_wrapper.py#L294",children:"Verify that the deployed App\u2019s private IP is the same as the ip in the cloud provider"}),". If it\u2019s different, update the deployed App ip with the IP on the cloud provider."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["If the IPs are different,\xa0",(0,s.jsxs)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ede6f78b4d4a78ae61b628696f6903d684e2224b/src/heavenly_cloud_service_wrapper.py#L294-L295",children:["update the deployed App IP with the IP on the cloud provider by calling ",(0,s.jsx)(t.em,{children:"UpdateResourceAddress"})]}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"If the operation fails, display an error to the sandbox end-user."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"If needed, verify that the deployed App\u2019s public IP is the same as the ip in the cloud provider."}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["If the IPs are different,\xa0",(0,s.jsxs)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ede6f78b4d4a78ae61b628696f6903d684e2224b/src/heavenly_cloud_service_wrapper.py#L297-L298",children:["update the deployed App ip with the ip on the cloud provider by calling ",(0,s.jsx)(t.em,{children:"SetAttributeValue"})," and setting the Public IP attribute"]}),"."]}),"\n",(0,s.jsx)(t.li,{children:"If the operation fails, display an error to the sandbox end-user."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"getvmdetails-method",children:"GetVmDetails method"}),"\n",(0,s.jsxs)(t.p,{children:["The\xa0",(0,s.jsx)(t.em,{children:"GetVmDetails"}),"\xa0method gets information about the App\u2019s VM, operating system, specifications and networking information. It is called by the default setup script when reserving the sandbox, after the\xa0",(0,s.jsx)(t.em,{children:"RefreshIp"}),"\xa0method is called, and can also be run manually by the sandbox end-user on deployed Apps from the App\u2019s\xa0",(0,s.jsx)(t.strong,{children:"VM Details"}),"\xa0pane."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Note:"}),"\xa0The implementation is expected to query the cloud provider for the details, but not return any cached or stored data."]}),"\n",(0,s.jsx)(t.h3,{id:"signature-3",children:"Signature"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"def GetVmDetails(self, context, requests, cancellation_context):\n"})}),"\n",(0,s.jsx)(t.h3,{id:"inputs-3",children:"Inputs"}),"\n",(0,s.jsx)(t.h4,{id:"context-3",children:"context"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"context:"}),"\xa0",(0,s.jsx)(t.em,{children:"context"}),"\xa0is a\xa0",(0,s.jsx)(t.em,{children:"ResourceCommandContext"}),"\xa0object that contains:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"connectivity - CloudShell server connectivity data for authentication with CloudShell Automation API"}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["resource - resource configuration settings entered when creating the Cloud Provider resource in the\xa0",(0,s.jsx)(t.strong,{children:"Inventory"}),"\xa0dashboard"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"reservation \u2013 reservation details"}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"connectors \u2013 details of any visual connectors between the Cloud Provider App and other endppoints in the sandbox"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,s.jsxs)(t.p,{children:["cloudshell/shell/core/driver_context.py ",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"view"})," ",(0,s.jsx)(t.a,{href:"https://raw.githubusercontent.com/QualiSystems/cloudshell-shell-core/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"raw"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'class ResourceCommandContext:\n    def __init__(self, connectivity, resource, reservation, connectors):\n        self.connectivity = connectivity  # Connectivity details that can help connect to the APIs\n        """:type : ConnectivityContext"""\n        self.resource = resource  # The details of the resource using the driver\n        """:type : ResourceContextDetails"""\n        self.reservation = reservation  # The details of the reservation\n        """:type : ReservationContextDetails"""\n        self.connectors = connectors  # The list of visual connectors and routes that are connected to the resource (the resource will be considered as the source end point)\n        """:type : list[Connector]"""\n'})}),"\n",(0,s.jsx)(t.h4,{id:"requests",children:"Requests"}),"\n",(0,s.jsx)(t.p,{children:"JSON string that contains a list of items containing App requests and deployed App data. This method can be called for a set of VMs."}),"\n",(0,s.jsx)(t.h4,{id:"cancellation-request",children:"Cancellation request"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,s.jsxs)(t.p,{children:["cloudshell/shell/core/driver_context.py ",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-shell-core/blob/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"view"})," ",(0,s.jsx)(t.a,{href:"https://raw.githubusercontent.com/QualiSystems/cloudshell-shell-core/36009fdec45134ae38cb9273328b7686be66e553/cloudshell/shell/core/driver_context.py",children:"raw"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'def __init__(self):\n    self.is_cancelled = False\n    """:type : bool"""\n'})}),"\n",(0,s.jsx)(t.h3,{id:"return-value-2",children:"Return value"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.em,{children:"VmDetailsData"}),"\xa0object in a serialized JSON."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-cp-core/blob/d58c094d9600b5a6232da16dada1d3a408a88ac9/package/cloudshell/cp/core/models.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,s.jsxs)(t.p,{children:["package/cloudshell/cp/core/models.py ",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/cloudshell-cp-core/blob/d58c094d9600b5a6232da16dada1d3a408a88ac9/package/cloudshell/cp/core/models.py",children:"view"})," ",(0,s.jsx)(t.a,{href:"https://raw.githubusercontent.com/QualiSystems/cloudshell-cp-core/d58c094d9600b5a6232da16dada1d3a408a88ac9/package/cloudshell/cp/core/models.py",children:"raw"})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'def __init__(self, vmInstanceData=None, vmNetworkData=None,appName = \'\',errorMessage = \'\'):\n    """\n    :param vmInstanceData: [VmDetailsProperty]\n    :param vmNetworkData:  [VmDetailsNetworkInterface]\n    :param appName:        str\n    :param errorMessage:   str\n    """\n \n    self.vmInstanceData = vmInstanceData if vmInstanceData else []  # type: [VmDetailsProperty]\n    self.vmNetworkData = vmNetworkData if vmNetworkData else []  # type: [VmDetailsNetworkInterface]\n    self.appName = appName\n    self.errorMessage = errorMessage\n'})}),"\n",(0,s.jsx)(t.h3,{id:"vmdetailsdata-properties",children:"vmDetailsData properties"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.em,{children:"vmDetailsData"}),"\xa0is used to describe the App\u2019s VM. All properties are optional."]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"appName"}),(0,s.jsx)(t.td,{children:"String"}),(0,s.jsxs)(t.td,{children:["The App\u2019s name. No need to assign it in the deploy operation. Must be assigned in ",(0,s.jsx)(t.em,{children:"getVmDetails"})," method."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"errorMessage"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{children:"Indication message to be displayed to the sandbox end-user when getting the vmDetails."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"vmNetworkData"}),(0,s.jsx)(t.td,{children:"array"}),(0,s.jsxs)(t.td,{children:["Array of cloudshell-cp-core VmDetailsNetworkInterface object. Create a ",(0,s.jsx)(t.em,{children:"vmNetworkData"})," object for each VM NIC you wish to associate with resource. See the VmDetailsNetworkInterface table below."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"vmInstanceData"}),(0,s.jsx)(t.td,{children:"array"}),(0,s.jsxs)(t.td,{children:["Array of cloudshell-cp-core\u2019s ",(0,s.jsx)(t.em,{children:"VmDetailsProperty"}),". Contains data about the VM instance attributes. It should be used to change persist values of the VM resource. For example to persist Storage and operating system data. See the VmDetailsProperty table below."]})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"vmdetailsnetworkinterface",children:"VmDetailsNetworkInterface"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"interfaceId"}),(0,s.jsx)(t.td,{children:"String"}),(0,s.jsx)(t.td,{children:"The network interface id with which the address is associated."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"networkId"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{children:"The unique id of the network associated with the network interface."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"isPrimary"}),(0,s.jsx)(t.td,{children:"bool"}),(0,s.jsx)(t.td,{children:"Determines if NIC is primary. Primary affects the default selected network in VmDetailsTab in cloudshell"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"isPredefined"}),(0,s.jsx)(t.td,{children:"bool"}),(0,s.jsx)(t.td,{children:"Determines if NIC is predefined. Predefined means that the network existed before the sandbox reservation. for example, a Static Management network that is not modeled in the blueprint."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"networkData"}),(0,s.jsx)(t.td,{children:"array"}),(0,s.jsx)(t.td,{children:"Array of cloudshell-cp-core VmDetailsProperty. Contains data describing the NIC. Examples of network properties include Device Index and MAC Address."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"privateIpAddress"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{children:"NIC address."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"publicIpAddress"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{children:"The public ip associated with the NIC\u2019s private ip."})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"vmdetailsproperty",children:"VmDetailsProperty"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"key"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"value"}),(0,s.jsx)(t.td,{children:"string"}),(0,s.jsx)(t.td,{})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"hidden"}),(0,s.jsx)(t.td,{children:"bool"}),(0,s.jsx)(t.td,{children:"Determines if the property is displayed to the sandbox end-user."})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"getvmdetails-method-implementation",children:"GetVmDetails method implementation"}),"\n",(0,s.jsx)(t.p,{children:"This method should perform the following steps:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ede6f78b4d4a78ae61b628696f6903d684e2224b/src/driver.py#L177",children:"Retrieve cloud provider resource connection credentials"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ede6f78b4d4a78ae61b628696f6903d684e2224b/src/heavenly_cloud_service_wrapper.py#L228",children:"Convert the JSON string to object"})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"For each request, do the following:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/d17640899a06fb69e61ac678d620301d76dfd3cb/src/heavenly_cloud_service_wrapper.py#L237-L239",children:"Retrieve identifiers"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/d17640899a06fb69e61ac678d620301d76dfd3cb/src/heavenly_cloud_service_wrapper.py#L241",children:"Query the cloud provider for the VM\u2019s configuration and networks"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/d17640899a06fb69e61ac678d620301d76dfd3cb/src/heavenly_cloud_service_wrapper.py#L242",children:"Populate\xa0vmInstanceData\xa0with the data (key-value) you wish to persist on the VM resource"}),". For example to persist the VM\u2019s Storage & operating system data."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsxs)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/d17640899a06fb69e61ac678d620301d76dfd3cb/src/heavenly_cloud_service_wrapper.py#L243",children:["Create ",(0,s.jsx)(t.em,{children:"vmNetworkData"})]}),".\xa0",(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/d17640899a06fb69e61ac678d620301d76dfd3cb/src/heavenly_cloud_service_wrapper.py#L194-L215",children:(0,s.jsx)(t.em,{children:"vmNetworkData"})}),"\xa0is a list of\xa0",(0,s.jsx)(t.em,{children:"VmDetailsNetworkInterface"}),", one for each VM NIC you wish to associate with the resource."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/d17640899a06fb69e61ac678d620301d76dfd3cb/src/heavenly_cloud_service_wrapper.py#L251-L252",children:"Collect as\xa0VmDetailsData\xa0result"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://github.com/QualiSystems/Custom-L2-Cloud-Provider-Shell-Example/blob/ede6f78b4d4a78ae61b628696f6903d684e2224b/src/driver.py#L178-L180",children:"Convert to JSON and return the result"}),"."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,l.M)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},36248:(e,t,n)=>{n.d(t,{c:()=>s});const s=n.p+"assets/images/App-Deployment-172c575856026965d8885057b0074107.png"},4552:(e,t,n)=>{n.d(t,{I:()=>o,M:()=>i});var s=n(11504);const l={},r=s.createContext(l);function i(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);
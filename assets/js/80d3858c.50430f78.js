"use strict";(self.webpackChunkcloudshell_help=self.webpackChunkcloudshell_help||[]).push([[37688],{24884:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var i=s(17624),r=s(4552);const t={sidebar_position:4},l="Create a Shared VPC using CloudFormation",o={id:"admin/supported-cloud-providers-in-cloudshell/public-cloud-provider-support-in-cloudshell/aws-integration-and-configuration/aws-integration/create-a-shared-vpc-using-cloudformation",title:"Create a Shared VPC using CloudFormation",description:"The Shared VPC\xa0option is supported in the AWS 2G shell and enables you to deploy sandboxes to an existing VPC.",source:"@site/versioned_docs/version-2023.3/admin/supported-cloud-providers-in-cloudshell/public-cloud-provider-support-in-cloudshell/aws-integration-and-configuration/aws-integration/create-a-shared-vpc-using-cloudformation.md",sourceDirName:"admin/supported-cloud-providers-in-cloudshell/public-cloud-provider-support-in-cloudshell/aws-integration-and-configuration/aws-integration",slug:"/admin/supported-cloud-providers-in-cloudshell/public-cloud-provider-support-in-cloudshell/aws-integration-and-configuration/aws-integration/create-a-shared-vpc-using-cloudformation",permalink:"/admin/supported-cloud-providers-in-cloudshell/public-cloud-provider-support-in-cloudshell/aws-integration-and-configuration/aws-integration/create-a-shared-vpc-using-cloudformation",draft:!1,unlisted:!1,editUrl:"https://github.com/QualiSystems/cloudshell-help/tree/main/versioned_docs/version-2023.3/admin/supported-cloud-providers-in-cloudshell/public-cloud-provider-support-in-cloudshell/aws-integration-and-configuration/aws-integration/create-a-shared-vpc-using-cloudformation.md",tags:[],version:"2023.3",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Integrating AWS with Cloud-based CloudShell Installation",permalink:"/admin/supported-cloud-providers-in-cloudshell/public-cloud-provider-support-in-cloudshell/aws-integration-and-configuration/aws-integration/create-a-management-vpc/integrating-aws-with-cloud-based-cloudshell"},next:{title:"Connect the Management VPC to Quali Server",permalink:"/admin/supported-cloud-providers-in-cloudshell/public-cloud-provider-support-in-cloudshell/aws-integration-and-configuration/aws-integration/connect-the-management-vpc-to-quali-server"}},c={},d=[];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"create-a-shared-vpc-using-cloudformation",children:"Create a Shared VPC using CloudFormation"}),"\n",(0,i.jsx)(n.p,{children:"The Shared VPC\xa0option is supported in the AWS 2G shell and enables you to deploy sandboxes to an existing VPC."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Prerequisites:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Successfully deployed ",(0,i.jsx)(n.strong,{children:"0_Main.yaml"})," stack"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"To create a Shared VPC:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Add a principal for the ",(0,i.jsx)(n.strong,{children:"TGW Share"})," resource share."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"As an admin, open your AWS management account."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Open the ",(0,i.jsx)(n.strong,{children:"Resource Access Manager"})," dashboard."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click the ",(0,i.jsx)(n.strong,{children:"TGW Share"})," resource share."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(26296).c+"",width:"1042",height:"233"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Modify"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(96380).c+"",width:"1029",height:"503"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Next"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Add the AWS account ID of the shared account and click ",(0,i.jsx)(n.strong,{children:"Next"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(98576).c+"",width:"788",height:"674"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Update the resource share."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create the CloudFormation stack."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Management Tools>CloudFormation"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(6e4).c+"",width:"1201",height:"369"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"As an admin, open the AWS account that will contain the shared VPC."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click the ",(0,i.jsx)(n.strong,{children:"Create Stack"})," button."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.strong,{children:"Select Template"})," page, select the ",(0,i.jsx)(n.strong,{children:"Specify an Amazon S3 template URL"})," option and enter the ",(0,i.jsx)(n.strong,{children:"3_Shared_VPC.yaml"}),"\xa0template's URL. The template URLs are provided in ",(0,i.jsx)(n.a,{href:"https://support.quali.com/hc/en-us/articles/231613247-Quali-s-Download-Center",children:"CloudShell Download Center"})," for each CloudShell release version."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Next"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.strong,{children:"Specify Details"})," page, enter a ",(0,i.jsx)(n.strong,{children:"Stack name"})," and fill in the installation parameters."]}),"\n",(0,i.jsxs)("table",{children:[(0,i.jsxs)("thead",{children:[(0,i.jsx)("th",{children:"Parameter"}),(0,i.jsx)("th",{children:"Description"})]}),(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Shared VPC CIDR"}),(0,i.jsxs)("td",{children:[(0,i.jsx)(n.p,{children:"VPC CIDR for the shared VPC. Default is 10.1.0.0/16."}),(0,i.jsx)(n.admonition,{title:"Important:",type:"note",children:(0,i.jsx)(n.p,{children:'We strongly recommend to use a "/16" CIDR range. A smaller range will force you to specify subnet ranges for every new sandbox and may dramatically decrease the number of sandboxes you can have running at the same time.'})})]})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Default Subnet CIDR"}),(0,i.jsxs)("td",{children:[(0,i.jsx)(n.p,{children:"Default CIDR to be used by CloudShell. This CIDR range must be included in the defined VPC CIDR. Default is 10.1.254.0/24."}),(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:'CloudShell cannot differentiate between this CIDR and the VPC CIDR, which can cause overlap. To avoid this from happening, we recommend specifying a limited default subnet CIDR. For example, "10.1.254.0/24\u201d or "10.1.253.0/24\u201d.'})})]})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"VPN Address"}),(0,i.jsx)("td",{children:"The public IP address of the router on the network in which Quali Server resides."})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Transit Gateway ID"}),(0,i.jsxs)("td",{children:["Created by the deployment of the management VPC. To find the transit gateway ID, open the main CloudFormation stack , click the ",(0,i.jsx)(n.strong,{children:"Outputs"})," tab and copy the ",(0,i.jsx)(n.strong,{children:"TGWid"})," value."]})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Execution Server Role ARN"}),(0,i.jsxs)("td",{children:["Created by the deployment of the management VPC. To find the role ARN, open the main CloudFormation stack , click the ",(0,i.jsx)(n.strong,{children:"Outputs"})," tab and copy the ",(0,i.jsx)(n.strong,{children:"ESRoleArn"})," value."]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(57708).c+"",width:"810",height:"681"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Next"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.strong,{children:"Options"})," page, click ",(0,i.jsx)(n.strong,{children:"Next"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.strong,{children:"Review"})," page, at the bottom, select the ",(0,i.jsx)(n.strong,{children:"I acknowledge that AWS CloudFormation might create IAM resources"})," check box."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Create"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The stack is created."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Modify the Execution Server role ARN."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"As an admin, open your AWS management account."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["In the ",(0,i.jsx)(n.strong,{children:"CloudFormation"}),' dashboard, click the main stack (bearing the stack name followed by "-VPCNAT. For example, my-stack-VPCNAT-2JDLSJ32D4LC).']}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click the ",(0,i.jsx)(n.strong,{children:"Resources"})," tab and click the ",(0,i.jsx)(n.strong,{children:"ESRole"}),"'s physical ID."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"CloudShell_EC2Access"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Edit Policy"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Switch to the JSON tab and add the following statement for each shared VPC you deployed:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'{\n            "Effect": "Allow",\n            "Action": "sts:AssumeRole",\n            "Resource": "<shared role arn>"\n        },\n'})}),"\n",(0,i.jsx)(n.p,{children:"For example: JSON defining two shared VPCs:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(41372).c+"",width:"922",height:"395"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:['Replace "<shared role arn>" with the shared role ARN. To find the shared VPC role ARN, open your AWS account in a new browser tab, open the shared VPC\xa0CloudFormation stack , click the ',(0,i.jsx)(n.strong,{children:"Outputs"})," tab and copy the ",(0,i.jsx)(n.strong,{children:"SharedVpcRoleArn"})," value."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Review policy"})," and then ",(0,i.jsx)(n.strong,{children:"Save changes"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Next, do one of the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If Quali Server is installed in your on-prem network: ",(0,i.jsx)(n.a,{href:"/admin/supported-cloud-providers-in-cloudshell/public-cloud-provider-support-in-cloudshell/aws-integration-and-configuration/aws-integration/connect-the-management-vpc-to-quali-server",children:"Connect the Management VPC to Quali Server"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["If Quali Server is also on AWS: ",(0,i.jsx)(n.a,{href:"/admin/supported-cloud-providers-in-cloudshell/public-cloud-provider-support-in-cloudshell/aws-integration-and-configuration/aws-integration/configure-an-execution-server-selector-for-aws-ec2",children:"Configure an Execution Server Selector for AWS EC2"}),"."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},6e4:(e,n,s)=>{s.d(n,{c:()=>i});const i=s.p+"assets/images/CloudFormationSection-91083ce60333f7547247edb09178974d.png"},26296:(e,n,s)=>{s.d(n,{c:()=>i});const i=s.p+"assets/images/ResourceAccessManager1-235d8235cc39a456bfb06909caadbb0e.png"},96380:(e,n,s)=>{s.d(n,{c:()=>i});const i=s.p+"assets/images/ResourceAccessManager2-4022be775db89a85f60c1c8c5fd588f7.png"},98576:(e,n,s)=>{s.d(n,{c:()=>i});const i=s.p+"assets/images/ResourceAccessManager3-d0c688424aad580f0808978330f18ecd.png"},57708:(e,n,s)=>{s.d(n,{c:()=>i});const i=s.p+"assets/images/SharedVPCInstallationParams-f472b3c2f62beaaa4b964482a40a17a2.png"},41372:(e,n,s)=>{s.d(n,{c:()=>i});const i=s.p+"assets/images/SharedVPCJson-9cbd187a918aa0b2e9cbdbfa26e9309a.png"},4552:(e,n,s)=>{s.d(n,{I:()=>o,M:()=>l});var i=s(11504);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunkcloudshell_help=self.webpackChunkcloudshell_help||[]).push([[53016],{94048:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>r});var a=t(17624),o=t(4552);const s={sidebar_position:1},i="Automating CloudShell Sandboxes for DevOps",l={id:"devguide/available-cs-api/automate-cs-sandboxes-for-devops",title:"Automating CloudShell Sandboxes for DevOps",description:"In this section, we\u2019ll look at different recipes for creating and using CloudShell Sandboxes as a part of your CI/CD or other DevOps pipelines. In this context, we\u2019ll concentrate on the use case of automating CloudShell externally from scripts or other platforms.",source:"@site/versioned_docs/version-2023.3/devguide/available-cs-api/automate-cs-sandboxes-for-devops.md",sourceDirName:"devguide/available-cs-api",slug:"/devguide/available-cs-api/automate-cs-sandboxes-for-devops",permalink:"/cloudshell-help/devguide/available-cs-api/automate-cs-sandboxes-for-devops",draft:!1,unlisted:!1,editUrl:"https://github.com/QualiSystems/cloudshell-help/tree/main/versioned_docs/version-2023.3/devguide/available-cs-api/automate-cs-sandboxes-for-devops.md",tags:[],version:"2023.3",lastUpdatedAt:171581458e4,sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Available CloudShell APIs",permalink:"/cloudshell-help/devguide/available-cs-api/"},next:{title:"Useful CloudShell Automation API Code Examples",permalink:"/cloudshell-help/devguide/available-cs-api/useful-cs-api-examples/"}},d={},r=[{value:"Available APIs",id:"available-apis",level:2},{value:"Which API to choose?",id:"which-api-to-choose",level:3},{value:"Where are the APIs documented?",id:"where-are-the-apis-documented",level:3},{value:"CloudShell Sandbox API",id:"cloudshell-sandbox-api",level:4},{value:"CloudShell Automation API",id:"cloudshell-automation-api",level:4},{value:"Starting and stopping a sandbox",id:"starting-and-stopping-a-sandbox",level:2},{value:"Using the Sandbox API from Python",id:"using-the-sandbox-api-from-python",level:3},{value:"Using the Automation API from Python",id:"using-the-automation-api-from-python",level:3},{value:"Sandbox API Missing and Upcoming Features",id:"sandbox-api-missing-and-upcoming-features",level:2},{value:"Executing Orchestration Commands",id:"executing-orchestration-commands",level:2},{value:"Integrating with CI tools",id:"integrating-with-ci-tools",level:2}];function p(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.M)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"automating-cloudshell-sandboxes-for-devops",children:"Automating CloudShell Sandboxes for DevOps"}),"\n",(0,a.jsx)(n.p,{children:"In this section, we\u2019ll look at different recipes for creating and using CloudShell Sandboxes as a part of your CI/CD or other DevOps pipelines. In this context, we\u2019ll concentrate on the use case of automating CloudShell externally from scripts or other platforms."}),"\n",(0,a.jsx)(n.h2,{id:"available-apis",children:"Available APIs"}),"\n",(0,a.jsx)(n.p,{children:"CloudShell currently supports two different sets of APIs which can be used to automate and integrate Sandboxes with DevOps."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The CloudShell Automation API (cloudshell-automation-api\xa0package) - This Python package contains a comprehensive set of APIs for anything from managing inventory and connections to administrating users and groups as well as managing sandboxes and blueprints. The package allows developers to use the TestShell API in shell drivers and Python scripts."}),"\n",(0,a.jsx)(n.li,{children:"The CloudShell Sandbox APIs - This RESTful API is intended for automating the consumption of sandboxes oustide of CloudShell. As such, it provides a specific set of commands focused on the workflow of starting and ending sandboxes, and running automation."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"which-api-to-choose",children:"Which API to choose?"}),"\n",(0,a.jsx)(n.p,{children:"If the functionality you\u2019re looking for is covered in the Sandbox APIs, it is recommended to use it over the CloudShell Automation API package. If not, you can consider using the Sandbox API for whatever subset of the required functionality it does offer and complement that with CloudShell Automation API calls."}),"\n",(0,a.jsx)(n.h3,{id:"where-are-the-apis-documented",children:"Where are the APIs documented?"}),"\n",(0,a.jsx)(n.h4,{id:"cloudshell-sandbox-api",children:"CloudShell Sandbox API"}),"\n",(0,a.jsxs)(n.p,{children:["The Sandbox API live documentation page is installed with CloudShell. To access it, simply browse to the following default address:\xa0",(0,a.jsx)(n.a,{href:"http://%5Bcloudshellportaladdress%5D:82/api/v2/explore/",children:"http://[CloudShellPortalAddress]:82/api/v2/explore/"}),". If you\u2019re accessing the link from the CloudShell Portal machine itself, or from the CloudShell SDK edition machine, you can simply use \u201clocalhost\u201d or \u201c127.0.0.1\u201d. The API documentation page allows you to test and experiment with the APIs as well as provide information on the different operations and parameters."]}),"\n",(0,a.jsx)(n.h4,{id:"cloudshell-automation-api",children:"CloudShell Automation API"}),"\n",(0,a.jsxs)(n.p,{children:["The latest Automation API online help is available\xa0",(0,a.jsx)(n.a,{href:"pathname:///api-docs/2023.3/Python-API",children:"here"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"When using the\xa0cloudshell-automation-api\xa0package, make sure to install the version of the API which is compatible with your CloudShell version. To make the task of finding the right version easier, this package follows a versioning schema different from other CloudShell packages. The\xa0major\xa0and\xa0minor\xa0version of the\xa0cloudshell-automation-api\xa0package will always match the CloudShell release its compatible with. Therefore, to install the latest compatible version you need to add these version requirements when installing from pip."}),"\n",(0,a.jsx)(n.p,{children:"For example, to install the latest\xa0cloudshell-automation-api\xa0compatible with CloudShell 8.1, run:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'python -m pip install "cloudshell-automation-api>;=8.1,<8.2"\n'})}),"\n",(0,a.jsx)(n.p,{children:"To install the latest\xa0cloudshell-automation-api\xa0compatible with CloudShell 8.0, run:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'python -m pip install "cloudshell-automation-api>;=7.1,<8.0"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"starting-and-stopping-a-sandbox",children:"Starting and stopping a sandbox"}),"\n",(0,a.jsxs)(n.p,{children:["The simplest and recommended way to start or stop a new sandbox instance from a blueprint is using the Sandbox API. The Sandbox API live documentation page contains the details of the response and request format. The basic URLs of these operations are\xa0",(0,a.jsx)(n.strong,{children:"/blueprints/{blueprint_identifier}/start"}),"\xa0and\xa0",(0,a.jsx)(n.strong,{children:"/sandboxes/{sandbox_id}/stop"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"using-the-sandbox-api-from-python",children:"Using the Sandbox API from Python"}),"\n",(0,a.jsx)(n.p,{children:"The following code sample demonstrates how to use the Sandbox APIs for a simple flow - creating a sandbox from a blueprint and then ensuring setup completes successfully after running some tests."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/sandbox_api_python_2_and_3/sandbox_api_example.py",children:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/sandbox_api_python_2_and_3/sandbox_api_example.py"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/sandbox_api_python_2_and_3/sandbox_api_example.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,a.jsxs)(n.p,{children:["devops_integration/sandbox_api_python_2_and_3/sandbox_context_example.py ",(0,a.jsx)(n.a,{href:"https://raw.githubusercontent.com/QualiSystems/devguide_examples/master/devops_integration/sandbox_api_python_2_and_3/sandbox_api_example.py",children:"view raw"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def main():\n    """\n    Example workflow of starting a sandbox, waiting for it to setup, then stopping it\n    :return:\n    """\n    api_example = SandboxRESTAPI(\'localhost\', \'8032\')\n    api_example.login("admin", "admin", "Global")\n    sandbox_id = api_example.start_sandbox(\'Simple blueprint\', datetime.timedelta(hours=2), \'test_sandbox\')\n    sandox_details = api_example.wait_for_sandbox_setup(sandbox_id)\n    run_some_tests_or_other_code(sandox_details)\n    api_example.stop_sandbox(sandbox_id)\n    api_example.wait_for_sandbox_teardown(sandbox_id)\n'})}),"\n",(0,a.jsxs)(n.p,{children:["This code uses a simple wrapper around the Sandbox API which uses the\xa0requests\xa0package. You can find the source code for that implementation\xa0",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/sandbox_api_python_2_and_3/sandbox_api/sandbox_apis.py",children:"here"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Since sandboxes used this way are really a scope for testing. It can be beneficial to use Python\u2019s\xa0with\xa0statement to ensure a sandbox is always set up and torn down properly with every usage. The following code wraps the Sandbox API as a context, ensuring proper cleanup and providing convenient access to the sandbox details."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/sandbox_api_python_2_and_3/sandbox_context_example.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,a.jsxs)(n.p,{children:["devops_integration/sandbox_api_python_2_and_3/sandbox_context_example.py ",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/sandbox_api_python_2_and_3/sandbox_context_example.py",children:"view"})," ",(0,a.jsx)(n.a,{href:"https://raw.githubusercontent.com/QualiSystems/devguide_examples/master/devops_integration/sandbox_api_python_2_and_3/sandbox_context_example.py",children:"raw"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'def main():\n    """\n    Example workflow of starting a sandbox, waiting for it to setup, then stopping it\n    :return:\n    """\n    api_example = SandboxRESTAPI(\'localhost\', \'8032\')\n    api_example.login("admin", "admin", "Global")\n    sandbox_id = api_example.start_sandbox(\'Simple blueprint\', datetime.timedelta(hours=2), \'test_sandbox\')\n    sandox_details = api_example.wait_for_sandbox_setup(sandbox_id)\n    run_some_tests_or_other_code(sandox_details)\n    api_example.stop_sandbox(sandbox_id)\n    api_example.wait_for_sandbox_teardown(sandbox_id)\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Both of the above examples are Python 2/3-compatible."})}),"\n",(0,a.jsx)(n.h3,{id:"using-the-automation-api-from-python",children:"Using the Automation API from Python"}),"\n",(0,a.jsx)(n.p,{children:"The following code demonstrates implementing the same basic flow using the CloudShell Automation API package:"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/python_api/python_api_example.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,a.jsxs)(n.p,{children:["devops_integration/python_api/python_api_example.py ",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/python_api/python_api_example.py",children:"view"})," ",(0,a.jsx)(n.a,{href:"https://raw.githubusercontent.com/QualiSystems/devguide_examples/master/devops_integration/python_api/python_api_example.py",children:"raw"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def main():\n    \"\"\"\n    Example workflow of starting a sandbox, waiting for it to setup, then stopping it\n    :return:\n    \"\"\"\n \n    session = CloudShellAPISession('localhost', \"admin\", \"admin\", \"Global\")\n    # Create the sandbox\n    sandbox = session.CreateImmediateTopologyReservation('test sandbox', owner='admin',\n                                                         durationInMinutes=120,\n                                                         topologyFullPath='Simple Blueprint1',\n                                                         globalInputs=[UpdateTopologyGlobalInputsRequest('Target Cloud', 'AWS')]).Reservation\n \n    sandbox_details = SandboxHelpers().wait_for_sandbox_setup(sandbox.Id, session,10)\n    run_some_tests_or_other_code(session, sandbox_details)\n    session.EndReservation(sandbox.Id)\n"})}),"\n",(0,a.jsx)(n.p,{children:"Similar to the Sandbox API example, we can wrap the setup and teardown of the sandbox in a context object and take advantage of the Python\xa0with\xa0operator to simplify the flow."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/python_api/python_api_context_example.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,a.jsxs)(n.p,{children:["devops_integration/python_api/python_api_context_example.py ",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/python_api/python_api_context_example.py",children:"view"})," ",(0,a.jsx)(n.a,{href:"https://raw.githubusercontent.com/QualiSystems/devguide_examples/master/devops_integration/python_api/python_api_context_example.py",children:"raw"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def main():\n    \"\"\"\n    Example workflow of starting a sandbox, waiting for it to setup, then stopping it\n    :return:\n    \"\"\"\n    connectivity_params = QualiConnectivityParams(api_service_host='localhost', domain='Global',\n                                                  password='admin', username='admin')\n    inputs = BlueprintInputs(global_inputs=[UpdateTopologyGlobalInputsRequest('Target Cloud', 'AWS')])\n \n    with SandboxContext(connectivity_params=connectivity_params,\n                        blueprint_name='Simple Blueprint1', duration=120,\n                        blueprint_inputs=inputs) as sandbox:\n        run_some_tests_or_other_code(sandbox)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"sandbox-api-missing-and-upcoming-features",children:"Sandbox API Missing and Upcoming Features"}),"\n",(0,a.jsxs)(n.p,{children:["Currently, the Sandbox API does not support the creation of future (pending) sandboxes. If your CloudShell environment requires this feature, you may need to fall back to the\xa0cloudshell-automation-api\xa0package API for sandbox reservation (using the\xa0",(0,a.jsx)(n.em,{children:"CreateReservation"}),"\xa0method)."]}),"\n",(0,a.jsx)(n.h2,{id:"executing-orchestration-commands",children:"Executing Orchestration Commands"}),"\n",(0,a.jsxs)(n.p,{children:["Executing orchestration commands from the Sandbox API is supported using the\xa0",(0,a.jsx)(n.strong,{children:"/sandboxes/{sandbox_identifier}/commands/{command_name}/start"}),"\xa0method. In addition, the Automation API package provides the necessary APIs to execute orchestration scripts in the sandbox:"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/python_api/python_api_example.py",children:"This Github Sample"}),"\xa0is by\xa0",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems",children:"QualiSystems"})]}),"\n",(0,a.jsxs)(n.p,{children:["devops_integration/python_api/python_api_example.py ",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/devguide_examples/blob/master/devops_integration/python_api/python_api_example.py",children:"view"})," ",(0,a.jsx)(n.a,{href:"https://raw.githubusercontent.com/QualiSystems/devguide_examples/master/devops_integration/python_api/python_api_example.py",children:"raw"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def run_some_tests_or_other_code(session, sandox_details):\n    session.ExecuteEnvironmentCommand(reservationId=sandox_details.Id, commandName='Update Version',\n                                      commandInputs=InputNameValue(Name='Version', Value='1.1'))\n    pp = pprint.PrettyPrinter(indent=4)\n    pp.pprint(jsonpickle.dumps(sandox_details))\n \n    time.sleep(10)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"integrating-with-ci-tools",children:"Integrating with CI tools"}),"\n",(0,a.jsx)(n.p,{children:"The same basic workflow demonstrated in the above examples can be used to implement a plugin for CI frameworks such as Jenkins, Travis or TeamCity."}),"\n",(0,a.jsx)(n.p,{children:"Several Quali community projects already provide readymade solutions for some CI tools."}),"\n",(0,a.jsxs)(n.p,{children:["The\xa0",(0,a.jsx)(n.a,{href:"https://github.com/jenkinsci/cloudshell-sandbox-plugin",children:"Sandbox-Jenkins-Plugin"}),"\xa0provides build steps for creating and ending sandboxes for Jenkins, as well as integration with the new PipeLines feature for continuous delivery and DevOps automation."]}),"\n",(0,a.jsxs)(n.p,{children:["The\xa0",(0,a.jsx)(n.a,{href:"https://github.com/QualiSystems/Sandbox-TeamCIty-Plugin",children:"Sandbox-Teamcity-Plugin"})," provides similar build steps and integration for TeamCity."]})]})}function h(e={}){const{wrapper:n}={...(0,o.M)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},4552:(e,n,t)=>{t.d(n,{I:()=>l,M:()=>i});var a=t(11504);const o={},s=a.createContext(o);function i(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);